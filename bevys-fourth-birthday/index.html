<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title>doomy</title>
    <meta name="description" content="Half a decade of Rust game engines, Bevy, project organization, and the glorious future of Rust game development">

    
    

    
<meta property="og:title" content="birthday_system.system()">
<meta property="og:description" content="Half a decade of Rust game engines, Bevy, project organization, and the glorious future of Rust game development">
<meta property="og:url" content="https:&#x2F;&#x2F;doomy.org&#x2F;bevys-fourth-birthday&#x2F;">
<meta property="og:type" content="article">
<meta property="og:site_name" content="doomy">

<meta property="og:image" content="https:&#x2F;&#x2F;doomy.org/bevys-fourth-birthday/opengraph.jpg">



    <!-- css -->
    <noscript>
        <style>
            .theme-switcher {
                display: none;
            }
        </style>
    </noscript>
    <link rel="stylesheet" href="/reset.css">
    <link rel="stylesheet" href="/feather.css">
    
    
    <link rel="stylesheet" href="/syntax-theme-light.css" media="screen" />
    <link rel="stylesheet" href="/syntax-theme-dark.css" media="screen and (prefers-color-scheme: dark)" />
    
    

    <link rel="stylesheet" id="syntax" />

    
    <script data-goatcounter=https://doomy-org.goatcounter.com/count async src="//gc.zgo.at/count.js"></script>
    

    
    <script></script>
    

    
    
</head>

<body >
    <div class="root">

        <nav>
            <div class="flex padded">
                <div class="flex fill vcenter">
                    <a href="/">
                        <h4>doomy</h4>
                    </a>
                </div>
                
                <button class="theme-switcher"></button>
                
            </div>
            
            <div class='header-image' style='background-image: url(/theme_images/default.gif);'>
            </div>
            
        </nav>



        
<div class='container'>
	<section class="post">
		<div class="title-and-info">
			<h2>birthday_system.system()</h2>
			<div class="info">
				<span>2024 Sep 08</span>

				
                    <span class='divider' />
                    <a href="https:&#x2F;&#x2F;mastodon.social&#x2F;@doomy" target="_blank">@doomy@mastodon.social</a>
				

				
			</div>
		</div>
		<article>
			
			
			
			

			


			<p><img src="https://doomy.org/bevys-fourth-birthday/opengraph.jpg" alt="A 3D scene that reads &quot;4 years of bevying&quot;" /></p>
<h3 id="table-of-contents">Table of contents</h3>
<ul>
<li><a href="https://doomy.org/bevys-fourth-birthday/#4-years-of-bevy"><strong>4 years of bevy</strong></a>
<ul>
<li><a href="https://doomy.org/bevys-fourth-birthday/#my-favorite-bevy-improvements-since-v0-1">Best bevy improvements</a></li>
<li><a href="https://doomy.org/bevys-fourth-birthday/#organizing-a-bevy-project-for-honor-and-success">Organizing a bevy project for honor and success</a></li>
<li><a href="https://doomy.org/bevys-fourth-birthday/#projects">Lessons from the past</a></li>
</ul>
</li>
<li><a href="https://doomy.org/bevys-fourth-birthday/#iii-looking-forward"><strong>Looking forward</strong></a>
<ul>
<li><a href="https://doomy.org/bevys-fourth-birthday/#what-i-m-still-waiting-for">What I'm still waiting for</a></li>
<li><a href="https://doomy.org/bevys-fourth-birthday/#bsn-bsn">bsn!</a></li>
</ul>
</li>
<li><a href="https://doomy.org/bevys-fourth-birthday/#closing-thoughts"><strong>Closing</strong></a></li>
</ul>
<h2 id="4-years-of-bevy">4 years of bevy</h2>
<p>Bevy released <a rel="noopener" target="_blank" href="https://bevyengine.org/news/bevys-fourth-birthday/#bevy-ecs-maturity">4 years</a> ago. Feel old yet? Well, I do, because my dive into making games with Rust started even earlier than that.</p>
<p>5 years ago, Bevy didn't exist. The popular choices for Rust game engines were "<a rel="noopener" target="_blank" href="https://github.com/PistonDevelopers/piston">Piston</a>", a modular game engine which pioneered a ton of useful crates<sup class="footnote-reference"><a href="#ui">1</a></sup>, and "<a rel="noopener" target="_blank" href="https://github.com/amethyst/amethyst">Amethyst</a>", a data-oriented, ECS-driven game engine, both of which are no longer in active development<sup class="footnote-reference"><a href="#piston">2</a></sup>.</p>
<p><img src="https://doomy.org/bevys-fourth-birthday/amethyst.png" alt="Amethyst, a precursor engine to Bevy, was archived on April 18, 2022, and is now read-only. Please ignore the fact that apparently nobody wants to talk to me on GitHub (0 notifications)." /></p>
<p>I have a particularly strong attachment to Amethyst, being an esteemed "Emeritus Member" of the <a rel="noopener" target="_blank" href="https://web.archive.org/web/20230423013649/https://amethyst.rs/team">Amethyst foundation</a>. (If you don't know what that means, it's basically like being Knighted, except without the problematic implications of serving the Royal Family, so it's actually far more prestigious in that regard).</p>
<p>I like to think the spirit of Amethyst is living on despite its ceased development, as Amethyst <a rel="noopener" target="_blank" href="https://github.com/bevyengine/bevy/blob/938d810766d34f1a300beb440273c3db1635ee5c/CREDITS.md?plain=1#L10">directly inspired</a> Bevy. Take a look at some <a rel="noopener" target="_blank" href="https://github.com/piedoom/j/blob/19ca304c12da31f4d29de080c6d7cda4156fdfdb/src/systems/movement.rs#L36C1-L57C2">sample code</a> from an Amethyst project I wrote 5 years ago:</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Default</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">MovementSystem</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> I was much newer to Rust at this point, but
</span></span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> I&#39;m pretty sure this was idiomatic in Amethyst
</span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span></span><span class="z-meta z-impl z-rust"><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span><span class="z-storage z-modifier z-lifetime z-rust">&#39;a</span><span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span><span class="z-meta z-impl z-rust"> <span class="z-meta z-generic z-rust">System<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span><span class="z-storage z-modifier z-lifetime z-rust">&#39;a</span><span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span> <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MovementSystem</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-type z-rust">type</span> <span class="z-entity z-name z-type z-rust">SystemData</span> <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">        <span class="z-meta z-generic z-rust">ReadStorage<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span><span class="z-storage z-modifier z-lifetime z-rust">&#39;a</span>, Movement<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">        <span class="z-meta z-generic z-rust">WriteStorage<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span><span class="z-storage z-modifier z-lifetime z-rust">&#39;a</span>, Transform<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">        <span class="z-meta z-generic z-rust">Read<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span><span class="z-storage z-modifier z-lifetime z-rust">&#39;a</span>, Time<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">    </span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">run</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&amp;</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">self</span>, <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-variable z-parameter z-rust">movements</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-variable z-parameter z-rust">mut</span> <span class="z-variable z-parameter z-rust">transforms</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-variable z-parameter z-rust">time</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>: <span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>SystemData</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-control z-rust">for</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>movement<span class="z-punctuation z-separator z-rust">,</span> transform</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-rust">in</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&amp;</span>movements<span class="z-punctuation z-separator z-rust">,</span> <span class="z-keyword z-operator z-bitwise z-rust">&amp;</span><span class="z-storage z-modifier z-rust">mut</span> transforms</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">join</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> move at a constant speed in the direction
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            transform<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">append_translation</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>movement<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">next</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&amp;</span>time</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p>This all might look strangely familiar, even if you've never heard of Amethyst. We're defining a type <code>SystemData</code> that describes all the parameters we want to retrieve from our world, and then <code>join</code> it, sort of like a <code>Query</code>. In Bevy, this would look like the following:</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">movement_system</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">query</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&amp;</span>Movement, <span class="z-keyword z-operator z-rust">&amp;</span><span class="z-storage z-modifier z-rust">mut</span> Transform<span class="z-punctuation z-section z-group z-end z-rust">)</span><span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span>, <span class="z-variable z-parameter z-rust">time</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Res<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span>Time<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-keyword z-control z-rust">for</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>movement<span class="z-punctuation z-separator z-rust">,</span> <span class="z-storage z-modifier z-rust">mut</span> transform</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-rust">in</span> query<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">iter_mut</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        transform<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">append_translation</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>movement<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">next</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&amp;</span>time</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p>In essence, we're still defining <code>SystemData</code>, but defined in the parameters of our system. Visually, we can see how Bevy has improved the ergonomics of using an ECS over the past 5 years, and not just because I unfairly added two lines of comments to the first snippet. This is a very, very small facet of improvements, so while we're on the topic, I'd be remiss if I didn't talk about</p>
<h2 id="my-favorite-bevy-improvements-since-v0-1">My favorite bevy improvements since v0.1</h2>
<p>Subjective lists are fun! Do you agree? Do you disagree? Remember to leave a comment, and tap that notification bell.</p>
<h3 id="system-less-systems"><code>system()</code>less systems</h3>
<p>If you're newer to Bevy, this post's title might not mean much to you, but back in Bevy v0-something, we registered systems <a rel="noopener" target="_blank" href="https://github.com/bevyengine/bevy/blob/9afe196f1690a6a6e47bf67ac740b4edeffd97bd/examples/3d/3d_scene.rs#L4C5-L7C44">like</a>:</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-meta z-path z-rust">App<span class="z-punctuation z-accessor z-rust">::</span></span>build<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_startup_system</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>setup<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">system</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></code></pre>
<p>Amusingly, this, combined with developers' propensity to suffix their system functions respectively, led to system registrations that look like:</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-meta z-path z-rust">App<span class="z-punctuation z-accessor z-rust">::</span></span>build<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_startup_system</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>birthday_system<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">system</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></code></pre>
<p>This is no more as of Bevy <a rel="noopener" target="_blank" href="https://bevyengine.org/news/bevy-0-6/#no-more-system">0.6</a> which requires only the function name - no <code>system()</code> call necessary.</p>
<blockquote>
<p>Bevy is fun to write, as its thoughtful design dovetails with Rust's type system and language features. After some practice, Bevy's API fades away into the background<sup class="footnote-reference"><a href="#types">3</a></sup>.</p>
</blockquote>
<h3 id="better-shaders">Better shaders</h3>
<p>I'm really not a math guy. I still don't "get" Quaternions (and I'm not fully convinced anyone else does). By extension, I'm not much of a graphics guy. Adding a custom shader to Bevy when it first released involved touching render code and writing a thesis of boilerplate that I was never able to defend against rustc. With <code>0.6</code> Bevy moved to <code>wgsl</code> and simplified custom shader creation. 8 releases later, I finally managed to implement a star background shader.</p>
<p>I would still love to see more tutorials in this space, specifically for <code>wgsl</code>.</p>
<h3 id="gizmos">Gizmos</h3>
<p>Gizmos, introduced in <a rel="noopener" target="_blank" href="https://bevyengine.org/news/bevy-0-11/#gizmos">0.11</a>, are a selection of "immediate mode" drawing primitives useful in debugging and prototyping. Gizmos are perfect for prototyping quick ideas while avoiding the added complexity of assets. I wrote a modest but respectable ~3,000 line project visualizing with only Gizmos before moving on to proper models.</p>
<div class="social">
    
    
    

    <a href=https:&#x2F;&#x2F;mastodon.social&#x2F;@doomy class="author" target="_blank">
        <span><img class="avatar" src=https:&#x2F;&#x2F;files.mastodon.social&#x2F;accounts&#x2F;avatars&#x2F;000&#x2F;367&#x2F;262&#x2F;original&#x2F;bafb14fd8ede1c01.jpg /></span>
        <div class="flex column gap-xsmall">
            <h6>doomy ðŸ¦€</h6>
            <p class="secondary small">@doomy@mastodon.social</p>
        </div>
    </a>

    
    

    
    
    
    
    <video src=https:&#x2F;&#x2F;files.mastodon.social&#x2F;media_attachments&#x2F;files&#x2F;113&#x2F;095&#x2F;180&#x2F;888&#x2F;111&#x2F;620&#x2F;original&#x2F;3c5544f3484c7471.mp4 controls="true"></video>
    
    

    <a href=https:&#x2F;&#x2F;mastodon.social&#x2F;@doomy&#x2F;113095182170100748 class="secondary small"> September  7, 2024 at  3:08 AM
    </a>
    
</div>
<h3 id="triggers-and-observers">Triggers and observers</h3>
<p>I can't include the removal of <code>.system()</code> without mentioning any of the other <em>major</em> ECS improvements; the continual focus on ergonomics is a big reason I think Bevy has become a relatively popular engine.</p>
<p>To better understand what triggers do, let's first understand how to write a Bevy project <em>before</em> triggers were introduced with regular events: Imagine we have a minefield. If one mine is triggered with a click, it causes an explosion with a defined radius. If any other mines are in range of that explosion, they're also triggered.</p>
<p>Using events, we can express this relationship like the following rusty pseudocode:</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Event</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">ExplodeEvent</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> <span class="z-variable z-other z-member z-rust">entity</span><span class="z-punctuation z-separator z-type z-rust">:</span> Entity </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">handle_explode_events</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">cmd</span><span class="z-punctuation z-separator z-rust">:</span> Commands, <span class="z-variable z-parameter z-rust">events</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">EventReader<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span>ExplodeEvent<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span>, <span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">write_events</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">EventWriter<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span>ExplodeEvent<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-keyword z-control z-rust">for</span> event <span class="z-keyword z-operator z-rust">in</span> events<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">read</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> ExplodeEvent <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> entity </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> event<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Do something with this entity like play an explosion noise, then despawn it
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        cmd<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">despawn_recursive</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Find any entities within a set radius (here it is done ~magically~)
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> entities_to_explode <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-support z-function z-rust">find_entities_in_blast_radius</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-control z-rust">for</span> entity_to_explode <span class="z-keyword z-operator z-rust">in</span> entities_to_explode <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            write_events<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">send</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>ExplodeEvent <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> entity<span class="z-punctuation z-separator z-rust">:</span> entity_to_explode </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<blockquote>
<p>For astute <em>observers</em> this might <em>trigger</em> a negative reaction, as this is an invalid system definition, requiring both mutable and immutable access to <code>ExplodeEvent</code> events. You'd actually need to use a <code>ParamSet</code> here, accumulate events to write in the event read loop, then send out events after reading.</p>
</blockquote>
<p>Additionally (and more importantly) these events do not trigger on the same update. Any <code>entities_to_explode</code> are added to the event queue, and then <code>hande_explode_events</code> runs on the next update. This isn't ideal when scaled to hundreds of objects. By comparison, triggers execute in a single update, even when recursed.</p>
<p>Bevy's official examples <a rel="noopener" target="_blank" href="https://bevyengine.org/examples/ecs-entity-component-system/observers/">has code illustrating this exact minefield idea</a>. Here's what the equivalent of the above looks like in our pseudocode:</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Event</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">ExplodeTrigger</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">on_explode</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">trigger</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Trigger<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span>ExplodeTrigger<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span>, <span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">cmd</span><span class="z-punctuation z-separator z-rust">:</span> Commands</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> entity <span class="z-keyword z-operator z-assignment z-rust">=</span> trigger<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Do something with this entity like play an explosion noise, then despawn it
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    cmd<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">despawn_recursive</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Find any entities within a set radius (here it is done ~magically~)
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> entities_to_explode <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-support z-function z-rust">find_entities_in_blast_radius</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-keyword z-control z-rust">for</span> entity_to_explode <span class="z-keyword z-operator z-rust">in</span> entities_to_explode <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        cmd<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">trigger_targets</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>ExplodeTrigger<span class="z-punctuation z-separator z-rust">,</span> entity_to_explode</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p>With triggers, all entities to explode are calculated in a single update, <em>and</em> we don't have issues juggling event mutability.</p>
<hr />
<h1 id="ii-looking-back">II. Looking back</h1>
<h2 id="organizing-a-bevy-project-for-honor-and-success">Organizing a bevy project for honor and success</h2>
<p>After many projects, repetition is inevitable. As I am Very Into Rust, I'm also very into conventions and planning (also known as over-engineering). With experience, I've generalized a project organization that works well, and condensed it into a template repo, which I use for new projects. Its goal is not to be a feature-complete starter like <a rel="noopener" target="_blank" href="https://github.com/janhohenheim/foxtrot">foxtrot</a>, but simply to nurture an understandable, scalable <a rel="noopener" target="_blank" href="https://github.com/piedoom/sobevy">project file structure</a>.</p>
<h3 id="very-important-crates">Very Important Crates</h3>
<p>There are a few batteries included, but these are the crates I use in every project. Let's take a look at the default <code>Cargo.toml</code>:</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span>dependencies<span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust">leafwing<span class="z-keyword z-operator z-arithmetic z-rust">-</span>input<span class="z-keyword z-operator z-arithmetic z-rust">-</span>manager <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> git <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>https://github.com/Leafwing-Studios/leafwing-input-manager/<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span> </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span><span class="z-source z-rust">bevy <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> version <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>0.14<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-separator z-rust">,</span> features <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>serialize<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span><span class="z-punctuation z-separator z-rust">,</span> default<span class="z-keyword z-operator z-arithmetic z-rust">-</span>features <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-constant z-language z-rust">true</span> </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span><span class="z-source z-rust">bevy_common_assets <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> version <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>0.11<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-separator z-rust">,</span> features <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>ron<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span> </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span><span class="z-source z-rust">bevy_asset_loader <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> version <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>0.21<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-separator z-rust">,</span> features <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>2d<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>3d<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>standard_dynamic_assets<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-separator z-rust">,</span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span> </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></code></pre>
<ul>
<li><code>leafwing-input-manager</code> is a generalized way to get input over keyboards and gamepads. Folks, do we love to write generalized code? We love it. That guy over there loves it, I see them, they know.</li>
<li><code>bevy</code> is bevy.</li>
<li><code>bevy_common_assets</code> provides asset loaders for - would you believe this - common asset types like <code>ron</code>. In fact, I'm only using its <code>ron</code> feature (as <code>json</code> doesn't let you use trailing commas ðŸ˜¡ðŸ˜¤)</li>
<li><code>bevy_asset_loader</code> implements all of the asset loading logic that you would have implemented yourself.</li>
</ul>
<p>There's also a few commonly used but alternative crates ready to be unleashed, but commented out. They're all related to <code>egui</code>.</p>
<pre data-lang="toml" class="language-toml z-code"><code class="language-toml" data-lang="toml"><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">bevy_egui</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>*<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span>
</span><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">bevy-egui-kbgp</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>*<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span>
</span><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">egui_extras</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-inline-table z-begin z-toml">{</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">version</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>*<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span><span class="z-punctuation z-separator z-inline-table z-toml">,</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">features</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-array z-begin z-toml">[</span><span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>file<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span><span class="z-punctuation z-separator z-array z-toml">,</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>image<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span><span class="z-punctuation z-definition z-array z-end z-toml">]</span> <span class="z-punctuation z-definition z-inline-table z-end z-toml">}</span>
</span><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">image</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-inline-table z-begin z-toml">{</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">version</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>*<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span><span class="z-punctuation z-separator z-inline-table z-toml">,</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">features</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-array z-begin z-toml">[</span><span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>png<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span><span class="z-punctuation z-definition z-array z-end z-toml">]</span> <span class="z-punctuation z-definition z-inline-table z-end z-toml">}</span>
</span><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">bevy-inspector-egui</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>*<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span>
</span></code></pre>
<p>The most important crate here is <code>bevy-inspector-egui</code>, which provides a powerful way to diagnose runtime issues, especially for people like me who think debugging is when you write <code>dbg!(..)</code>. We also make <code>bevy-egui-kbgp</code> available, which adds gamepad input support to <code>egui</code> menus. Until Bevy's own UI and editor gathers momentum, <code>egui</code> is the de-facto way to present UI in games. That's it though, just 3-ish crates by default. Outside of setting up <code>bevy_asset_loader</code>, this template doesn't really <em>do</em> much else. It's more about project organization.</p>
<blockquote>
<p><code>egui</code>! It's a great library. However, the difficulty with styling, lack of gamepad support, and ever-increasing world data needed to render custom widgets renders it a less-than-optimal choice. Additionally, <code>egui</code> and Bevy's philosophies compete: there is a tendency to include all UI code in a single system to reduce complexity, leading to incredibly long and terse UI system functions. I'm looking forward to Bevy's own UI maturing providing a more constructive relationship between ECS and UI.</p>
</blockquote>
<h3 id="project-organization">Project organization</h3>
<blockquote>
<p>My 6th grade math teacher had a poster that said "Organization is the key to success". So true! I also couldn't stay quiet during his class, which also taught me about detention. Although I don't consider myself a particularly organized person, my brain does have those peculiar deleterious set of genes innate to humans that make us clap our hands and jump up and down whenever we successfully organize things into groups.</p>
</blockquote>
<blockquote>
<p>Here's another fact about my mysterious past: I used to be really into Ruby on Rails (and according to some Rust surveys, a lot you probably were, too). Rails is <em>all about</em> "convention over configuration". That quote itself was coined by Rails' creator, Hatsune Miku.</p>
</blockquote>
<blockquote>
<p>MVC isn't exactly a sexy term. It's arguably sexless. But parts of MVC began to influence how I began to structure my Bevy projects, drawing inspiration particularly from strong separation of data and functionality. In Rails, the data bits are "models", and the functionality bits are "controllers". These are analogous to components and systems in Bevy. Rails has one more level of organization: controllers are not single functions, but a type with several inherited methods (e.g., "new", "create", "delete"). In Bevy, these are akin to <code>Plugin</code>s, which group systems into a single unit.</p>
</blockquote>
<p>In my experience, it's rare that a system <em>doesn't</em> belong in a single <code>Plugin</code>. Grouping related systems can help ease the cognitive load of storing larger projects in (human) working memory. To achieve this, all systems in my projects are private<sup class="footnote-reference"><a href="#utility">4</a></sup>, and only the containing <code>Plugin</code> is exposed, resulting in this directory structure:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">src/</span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">components/</span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mod.rs</span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">my_component.rs</span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">plugins/</span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mod.rs</span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">my_thing.rs</span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">resources/</span></span>
</span></code></pre>
<p>This simple setup works well for my projects and seems to grow manageably. So far.</p>
<h4 id="preludes">Preludes</h4>
<p>Bevy developers love preludes! <code>use bevy::prelude::*</code> is far easier than importing every item by name. So why not extend this pattern to my own projects and be my own consumer by adding a <code>pub use</code> statement within a <code>prelude</code> module in our <code>lib.rs</code>?</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-module z-rust">mod</span> <span class="z-entity z-name z-module z-rust">prelude</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">    <span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust"><span class="z-keyword z-other z-rust">super</span><span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">allow</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">unused_imports</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> <span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span><span class="z-meta z-path z-rust">components<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-meta z-path z-rust">error<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-meta z-path z-rust">plugins<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-meta z-path z-rust">resources<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-meta z-path z-rust">states<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-meta z-path z-rust">ui<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-meta z-path z-rust">util<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Leave out `pub` for any types you don&#39;t want available in these modules.
</span></span></code></pre>
<p>With this pattern, our game's most important types are available with a single import of <code>use crate::prelude::*</code>.</p>
<blockquote>
<p>Note that I have a <code>states/</code> directory in my template repo, but I've yet to have an application need more than one state (and I don't even know if that's supported tbh). States <em>are</em> just resources, so it's better to add a <code>state.rs</code> file in <code>resources/</code> instead.</p>
</blockquote>
<h3 id="naming">Naming</h3>
<p>If it is necessary to convey type information in a type's name, it can be a signal that the project's organization may need improvement. <code>Controller</code> is a better type name than <code>ControllerComponent</code>; it is easier to type, clearer to read, and is already known to be a component by implementing the <code>Component</code> trait. If disambiguation is necessary, modules can be used. For example, event and trigger names are often similar to component names. When using the <code>prelude</code> method, a problem arises: What if we have an <code>Equip</code> component and an <code>Equip</code> event in the same namespace?</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Errors
</span></span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-module z-rust">mod</span> <span class="z-entity z-name z-module z-rust">prelude</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">  <span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust"><span class="z-keyword z-other z-rust">super</span><span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">  <span class="z-storage z-modifier z-rust">pub</span> <span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> <span class="z-meta z-path z-rust">components<span class="z-punctuation z-accessor z-rust">::</span></span>Equip<span class="z-punctuation z-separator z-rust">,</span> <span class="z-meta z-path z-rust">events<span class="z-punctuation z-accessor z-rust">::</span></span>Equip </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-module z-rust">mod</span> <span class="z-entity z-name z-module z-rust">components</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">  <span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Equip</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-module z-rust">mod</span> <span class="z-entity z-name z-module z-rust">events</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">  <span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Equip</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p>It's tempting to add an "<code>Event</code>" to the end of the type's name, but this creates a new issue where <code>Event</code> types litter the project with no apparent grouping. We could <em>prefix</em> the type name with "Event" to search alphabetically for related types in our editor, but this <em>forces</em> us to be verbose, even in situations where it's unnecessary, and is downright awkward.</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Not the best solution
</span></span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Components are common so no suffix is added
</span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Equip</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Events get a suffix added to the type name
</span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">EquipEvent</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> pub struct EventEquip; // Would be better for searching for events, but looks weird
</span></span></code></pre>
<p>Instead of adding to the type name, we can leverage modules. Because component types are <em>extremely</em> common to use, they can stay in the <code>prelude</code> root. We'll move <code>event</code>s and <code>trigger</code>s to their respectively named modules available within <code>prelude</code>.</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-module z-rust">mod</span> <span class="z-entity z-name z-module z-rust">prelude</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">  <span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust"><span class="z-keyword z-other z-rust">super</span><span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">  <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> This is identical as our first example, but we&#39;re only exposing
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">  <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> the entire events module instead of specific items
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">  <span class="z-storage z-modifier z-rust">pub</span> <span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> <span class="z-meta z-path z-rust">components<span class="z-punctuation z-accessor z-rust">::</span></span>Equip<span class="z-punctuation z-separator z-rust">,</span> events </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-module z-rust">mod</span> <span class="z-entity z-name z-module z-rust">components</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">  <span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Equip</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-module z-rust">mod</span> <span class="z-entity z-name z-module z-rust">events</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">  <span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Equip</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Use in the project
</span></span><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-keyword z-other z-rust">crate</span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">prelude<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">my_system</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">equips</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span><span class="z-keyword z-operator z-rust">&amp;</span>Equip<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span>, <span class="z-variable z-parameter z-rust">events</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">EventReader<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span><span class="z-meta z-path z-rust">event<span class="z-punctuation z-accessor z-rust">::</span></span>Equip<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> No conflicts!
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p>If in a particular file, components were completely unused, while events were used heavily, we could write <code>use crate::prelude::event::*</code>. This flexibility is a nice bonus to modules neatly separating our ever-growing list of types available in <code>prelude</code>.</p>
<blockquote>
<p>While we're crossing into subjective territory, I <em>like</em> namespacing by modules instead of adding extra info to the actual type name. That's what modules are there for to begin with, right? I <em>like</em> writing <code>event::Equip</code> instead of <code>Equip</code>, even if it weren't required due to aliasing another type in the prelude.</p>
</blockquote>
<h2 id="projects">Projects</h2>
<p>Outside of a few projects, I've rarely pushed one to a "complete" playable state. I'm okay with that! I work on a product team of a tech company. It's nice to start creating without a clear goal. Ideating, finding creative solutions to problems, and promptly deleting those creative solutions because you've moved in a new direction isn't a good way to develop games, but it's a great way to learn.</p>
<p>Let's peruse the few dozen gibberish-named private repositories of ideas stashed on my GitH*b and see if I've actually learned anything.</p>
<h2 id="bevy-puzzle"><a rel="noopener" target="_blank" href="https://github.com/piedoom/bevy-puzzle">bevy-puzzle</a></h2>
<p>It's a puzzle game with tetrominoes! <a rel="noopener" target="_blank" href="https://piedoom.github.io/bevy-puzzle/">Simple as it is, I'm happy with how this turned out</a>. Sure, it may crash when you win because it tries to write to a highscores file that doesn't exist in the WASM build, but the several seconds of gameplay beforehand is fun!</p>
<p>This project highlights a recurring theme for me: I don't like 2D. Whenever I'm a few hours into a project using sprites, I can only think of how much easier everything would be in 3D space. I don't want to deal with sprite ordering in an isometric 2D game. We live in the future. We have access to more dimensions now, even the 2D is 3D<sup class="footnote-reference"><a href="#dimensions">5</a></sup>.</p>
<div class="social">
    
    
    

    <a href=https:&#x2F;&#x2F;mastodon.social&#x2F;@doomy class="author" target="_blank">
        <span><img class="avatar" src=https:&#x2F;&#x2F;files.mastodon.social&#x2F;accounts&#x2F;avatars&#x2F;000&#x2F;367&#x2F;262&#x2F;original&#x2F;bafb14fd8ede1c01.jpg /></span>
        <div class="flex column gap-xsmall">
            <h6>doomy ðŸ¦€</h6>
            <p class="secondary small">@doomy@mastodon.social</p>
        </div>
    </a>

    
    

    
    
    
    
    <video src=https:&#x2F;&#x2F;files.mastodon.social&#x2F;media_attachments&#x2F;files&#x2F;113&#x2F;095&#x2F;328&#x2F;276&#x2F;372&#x2F;009&#x2F;original&#x2F;51e2cb1eb1f62d38.mp4 controls="true"></video>
    
    

    <a href=https:&#x2F;&#x2F;mastodon.social&#x2F;@doomy&#x2F;113095335789830890 class="secondary small"> September  7, 2024 at  4:12 AM
    </a>
    
</div>
<h2 id="wordlrs"><a rel="noopener" target="_blank" href="https://github.com/piedoom/wordlrs">wordlrs</a></h2>
<p>Wordle is a relatively simple game to implement, so <a rel="noopener" target="_blank" href="https://piedoom.github.io/wordlrs/">this project</a> furthered my working knowledge of egui with an achievable goal. A feature of this implementation is that it is language-independent. (If the language uses an alphabet. å¯¹ä¸èµ·<sup class="footnote-reference"><a href="#chinese">6</a></sup>). While this sits among my rare playable projects, it's not at all interesting. Wordle doesn't particularly take full advantage of an ECS (but <a rel="noopener" target="_blank" href="https://en.wikipedia.org/wiki/Tetris_99">Wordle 99</a> absolutely would, someone get on that).</p>
<h2 id="modsynth"><a rel="noopener" target="_blank" href="https://github.com/piedoom/modsynth">modsynth</a></h2>
<p>Not a Bevy project (nor a eurorack), modsynth is a naive model synthesis implementation (also known as "wave function collapse"). My main takeaway from this project is I am not good at math, and constraint solving is hard<sup class="footnote-reference"><a href="#constraints">7</a></sup>.</p>
<p>I did, however, create a neat dynamically generated 3D scene using Bevy. It's exactly like "Lethal Company", except without any gameplay.</p>
<div class="social">
    
    
    

    <a href=https:&#x2F;&#x2F;mastodon.social&#x2F;@doomy class="author" target="_blank">
        <span><img class="avatar" src=https:&#x2F;&#x2F;files.mastodon.social&#x2F;accounts&#x2F;avatars&#x2F;000&#x2F;367&#x2F;262&#x2F;original&#x2F;bafb14fd8ede1c01.jpg /></span>
        <div class="flex column gap-xsmall">
            <h6>doomy ðŸ¦€</h6>
            <p class="secondary small">@doomy@mastodon.social</p>
        </div>
    </a>

    
    <p>alright so i got my model synthesis program running in bevy so i can fit together a bunch of uninteresting hallways</p>

    
    
    
    
    <video src=https:&#x2F;&#x2F;files.mastodon.social&#x2F;media_attachments&#x2F;files&#x2F;111&#x2F;756&#x2F;626&#x2F;524&#x2F;699&#x2F;726&#x2F;original&#x2F;11874dbad2f76ff4.mp4 controls="true"></video>
    
    

    <a href=https:&#x2F;&#x2F;mastodon.social&#x2F;@doomy&#x2F;111756628711521099 class="secondary small"> January 14, 2024 at  5:23 PM
    </a>
    
</div>
<h2 id="bevy-planty"><a rel="noopener" target="_blank" href="https://github.com/piedoom/bevy-planty">bevy-planty</a></h2>
<p>It's an <a rel="noopener" target="_blank" href="https://en.wikipedia.org/wiki/L-system">L-system</a> visualizer! L-systems use relatively simple instructions to generate complex structures, and can be used to model plants.</p>
<p>egui is great, but working on this project was an early encounter with its aforementioned pitfalls. There's more than a few broken buttons.</p>
<div class="social">
    
    
    

    <a href=https:&#x2F;&#x2F;mastodon.social&#x2F;@doomy class="author" target="_blank">
        <span><img class="avatar" src=https:&#x2F;&#x2F;files.mastodon.social&#x2F;accounts&#x2F;avatars&#x2F;000&#x2F;367&#x2F;262&#x2F;original&#x2F;bafb14fd8ede1c01.jpg /></span>
        <div class="flex column gap-xsmall">
            <h6>doomy ðŸ¦€</h6>
            <p class="secondary small">@doomy@mastodon.social</p>
        </div>
    </a>

    
    

    
    
    
    
    <video src=https:&#x2F;&#x2F;files.mastodon.social&#x2F;media_attachments&#x2F;files&#x2F;113&#x2F;109&#x2F;694&#x2F;509&#x2F;647&#x2F;691&#x2F;original&#x2F;6945540c8887e242.mp4 controls="true"></video>
    
    

    <a href=https:&#x2F;&#x2F;mastodon.social&#x2F;@doomy&#x2F;113109695733994318 class="secondary small"> September  9, 2024 at  5:08 PM
    </a>
    
</div>
<h2 id="bevy-blast-ultra"><a rel="noopener" target="_blank" href="https://github.com/piedoom/bevy_blast_ultra">bevy blast ultra</a></h2>
<p>My solo Bevy jam #4 entry: a marble run game inspired by <em>Super Marble Blast Ultra</em> with levels designed in Blender using Blenvy. In retrospect, I have no idea how I pulled this off in a week. <a rel="noopener" target="_blank" href="http://127.0.0.1:1111/bevy-jam-4/">I have an epic-style post talking about this some more</a>.</p>
<p><img src="/bevy-jam-4/rails.png" alt="Marble on rails in game" /></p>
<hr />
<h1 id="iii-looking-forward">III. Looking forward</h1>
<h2 id="what-i-m-still-waiting-for">What I'm still waiting for</h2>
<p>In my game, I have items, which are described as an <code>Asset</code> using ron.</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> A general in-game item
</span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Debug<span class="z-punctuation z-separator z-rust">,</span> Component<span class="z-punctuation z-separator z-rust">,</span> Clone<span class="z-punctuation z-separator z-rust">,</span> Reflect<span class="z-punctuation z-separator z-rust">,</span> Asset<span class="z-punctuation z-separator z-rust">,</span> Serialize<span class="z-punctuation z-separator z-rust">,</span> Deserialize</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Item</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> The in-game name of this item
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> <span class="z-variable z-other z-member z-rust">name</span><span class="z-punctuation z-separator z-type z-rust">:</span> String,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> The in-world mass of this item
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> <span class="z-variable z-other z-member z-rust">mass</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-storage z-type z-rust">f32</span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> The space this item displaces in the [`Inventory`]
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> <span class="z-variable z-other z-member z-rust">size</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-storage z-type z-rust">usize</span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> The worth of this item in `Credits`
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> <span class="z-variable z-other z-member z-rust">value</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-storage z-type z-rust">usize</span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    name<span class="z-punctuation z-separator z-rust">:</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>scrap metal<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    mass<span class="z-punctuation z-separator z-rust">:</span> <span class="z-constant z-numeric z-float z-rust">0.</span><span class="z-constant z-numeric z-float z-rust">1</span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    size<span class="z-punctuation z-separator z-rust">:</span> <span class="z-constant z-numeric z-integer z-decimal z-rust">1</span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    value<span class="z-punctuation z-separator z-rust">:</span> <span class="z-constant z-numeric z-integer z-decimal z-rust">10</span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></code></pre>
<p>Assets are perfect, because I can modify or extend my game with new items without recompilation.</p>
<p>Items aren't entirely useful without the ability to pick them up, so we'll also need an inventory:</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> This is overly simplistic and not doing anything with our items `size` or `mass`, but it&#39;ll get the idea across, just wait.
</span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Debug<span class="z-punctuation z-separator z-rust">,</span> Clone<span class="z-punctuation z-separator z-rust">,</span> Component<span class="z-punctuation z-separator z-rust">,</span> Reflect</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Inventory</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> Items and their count in the inventory
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">items</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-meta z-generic z-rust">HashMap<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span><span class="z-meta z-generic z-rust">Handle<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span>Item<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span>, <span class="z-storage z-type z-rust">usize</span><span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p><code>Inventory</code> is a <code>Component</code> that contains references to <code>Item</code>s in the form of a <code>Handle&lt;Asset&gt;</code>. This provides two obvious benefits: items can be hot-reloaded, and cloning handles is cheap compared to cloning an entire <code>Item</code>  fully, especially as items gain fields and additional complexity. This works well until we need to serialize.</p>
<p><code>Handle</code>s are runtime specific, so while we can technically write a <code>Handle</code>'s ID to a file, it won't be valid the next run. Instead, <code>AssetPath</code>s are required to successfully serialize and deserialize. Bevy's <a rel="noopener" target="_blank" href="https://docs.rs/bevy_animation/0.14.1/src/bevy_animation/graph.rs.html#166">animation graph</a> does something similar to this, but it's not necessarily a fun or easy thing to implement in your own projects.</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> From `bevy_animation` - https://docs.rs/bevy_animation/0.14.1/src/bevy_animation/graph.rs.html#166
</span></span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> A version of `Handle&lt;AnimationClip&gt;` suitable for serializing as an asset.
</span></span><span class="z-source z-rust"><span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span>
</span></span><span class="z-source z-rust"><span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> This replaces any handle that has a path with an [`AssetPath`]. Failing
</span></span><span class="z-source z-rust"><span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> that, the asset ID is serialized directly.
</span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Serialize<span class="z-punctuation z-separator z-rust">,</span> Deserialize</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-enum z-rust">enum</span> <span class="z-entity z-name z-enum z-rust">SerializedAnimationClip</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> Records an asset path.
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust">    AssetPath<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-generic z-rust">AssetPath<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span><span class="z-storage z-modifier z-lifetime z-rust">&#39;static</span><span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> The fallback that records an asset ID.
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> Because asset IDs can change, this should not be relied upon. Prefer to
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> use asset paths where possible.
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust">    AssetId<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-generic z-rust">AssetId<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span>AnimationClip<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p><em>This is just the data representation. Actually serializing and deserializing this isn't as straightforward. At least to me.</em></p>
<p>The ability to "persist" asset handles is useful - especially with dependency resolution. Wouldn't it be nice if we could just <em>do</em> that?</p>
<h1 id="bsn-bsn">bsn! bsn!</h1>
<p>Bevy's proposed scene format is going to solve all of my life's problems. For one, it solves that <code>Handle&lt;_&gt;</code> issue by introducing <code>Construct</code>: a way to initialize components that need to access stuff from our ECS world. Now, we can serialize handles to an <code>AssetPath&lt;_&gt;</code>, and neatly deserialize back into a <code>Handle&lt;_&gt;</code> via access to the asset server. This can immediately simplify save strategies.</p>
<p>Now that we have a way to reference other assets, my idea of prefabs is possible. Let's go back to my top-down space game with the inventory as an example of why this is useful.</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Our assets directory</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">assets/</span></span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">items/</span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">laser.weapon.ron</span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">metal.item.ron</span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">battery.energy.ron</span></span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">models/</span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">crab.gltf</span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ship.gltf</span></span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">creatures/</span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">crab.creature.ron</span></span>
</span></code></pre>
<p>You can think of <code>creatures</code> as NPC definitions. If we load <code>crab.creature.ron</code>, we should be able to spawn it and its components. This is what the crab creature <code>ron</code> looks like:</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    name<span class="z-punctuation z-separator z-rust">:</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>crab<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    model<span class="z-punctuation z-separator z-rust">:</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>models/crab.gltf<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    inventory<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>items/laser.weapon.ron<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-constant z-numeric z-integer z-decimal z-rust">1</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>items/battery.energy.ron<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-constant z-numeric z-integer z-decimal z-rust">1</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>items/metal.item.ron<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-constant z-numeric z-integer z-decimal z-rust">3</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    <span class="z-punctuation z-section z-group z-end z-rust">]</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></code></pre>
<p>This is valid <code>ron</code>, so we could load this - but Bevy has no idea what these random path strings mean. We first need to map our asset paths to runtime handles. Luckily <code>[bevy_asset_loader](https://docs.rs/bevy_asset_loader/latest/bevy_asset_loader/)</code> does this for us. All we need to do is load our items and models, then load our creatures - probably by checking an <code>Added&lt;Creature&gt;</code> query and building the described entity manually. This works, though it's highly manual, prone to errors, annoyances with circular dependencies, and is a general bother to maintain and extend.</p>
<p>Bevy doesn't have a concept of a common collection of components on purpose (Bundles and Archetypes don't count). There is no concept of the "shape" of an entity known statically. Our "NPC" is nothing more than interactions between specific components: they are entities that have a <code>Transform</code> component, a <code>Controller</code> component for movement, and a <code>Thinker</code> component for directing <code>Controller</code> movement. <strong>Nothing in the type system describes that specific relationship of components</strong> - and it shouldn't. Bevy's API encourages systems to use the least amount of components necessary, which results in <em>general</em> code that adapts with emergent behavior as systems and components are added.</p>
<p>But, our <code>ron</code> data description goes against this philosophy and limits flexibility ðŸ˜¢. What if we wanted to add a unique <code>BossName</code> component? We'd have to add a whole new field to the <code>creature</code> struct to support this optional <code>BossName</code> component, which means recompilation is required. It also inevitably grows the entity description struct into a gigantic mess of <code>Option&lt;Component&gt;</code> fields.</p>
<p>With <code>bsn</code>, we can instead define almost <em>everything</em> in our game as a Bevy scene, with any arbitrary components, including our <code>BossName</code> or anything else, allowing us to build significant game content without needing to venture into the codebase.</p>
<p>This is similar to Bevy's <code>DynamicEntity</code> (used in <code>DynamicScene</code>), except that we can now add and save components with world context, meaning we can serialize a <code>Handle&lt;_&gt;</code> to an <code>AssetPath&lt;'_&gt;</code> and back into a <code>Handle&lt;_&gt;</code>.</p>
<p><a rel="noopener" target="_blank" href="https://github.com/bevyengine/bevy/discussions/14437">Check out the whole thread on GitHub for more details on Bevy's new scene system</a>.</p>
<h2 id="closing-thoughts">Closing thoughts</h2>
<p>Organization is not easy. Bevy hitting 4 years, all the while gaining momentum, is beyond encouraging. Bevy community members are some of the most engaging, friendly, and helpful people I've met online. It's special to share a space where there's little profit motive - just creative people making cool stuff that inspires them.</p>
<hr />
<h3 id="footnotes">Footnotes</h3>
<div class="footnote-definition" id="ui"><sup class="footnote-definition-label">1</sup>
<p>Including some of the earliest work on a fully-Rust UI toolkit named <a rel="noopener" target="_blank" href="https://github.com/PistonDevelopers/conrod">conrod</a>. I can't overstate how cool it was to be able to write a GUI application, completely in Rust, 5 years ago.</p>
</div>
<div class="footnote-definition" id="piston"><sup class="footnote-definition-label">2</sup>
<p>There's no indication that Piston is EOL like Amethyst, and there are some commits this year, but it looks to be in maintence mode.</p>
</div>
<div class="footnote-definition" id="types"><sup class="footnote-definition-label">3</sup>
<p>You know you're writing good rust when you have to include <code>#[allow(clippy::too_many_arguments)]</code> or <code>#[allow(clippy::type_complexity)]</code></p>
</div>
<div class="footnote-definition" id="utility"><sup class="footnote-definition-label">4</sup>
<p>Sort of. Generic or error handling systems especially may be used across many plugins. I add these special cases to a <code>utility</code> module public to the crate.</p>
</div>
<div class="footnote-definition" id="dimensions"><sup class="footnote-definition-label">5</sup>
<p>When I work in 2D, I feel like I'm slowly walking down a big hill, wishing I remembered my Heelys so I could just slide to the bottom.</p>
</div>
<div class="footnote-definition" id="chinese"><sup class="footnote-definition-label">6</sup>
<p>Some argue that Chinese has an alphabet, it's just thousands and thousands of characters long. In any case it cannot be wordled (but can be <a rel="noopener" target="_blank" href="https://www.pinyindle.com">pinyindle'd</a>)</p>
</div>
<div class="footnote-definition" id="constraints"><sup class="footnote-definition-label">7</sup>
<p>I may have had an easier time if I referenced more than <a rel="noopener" target="_blank" href="https://www.youtube.com/watch?v=A2ODauA1a0M">a single YouTube video on repeat for several hours</a>. (This entire experience also revealed to me just how criminally underappreciated Paul Merrell is for his research in this area.)</p>
</div>

			


		</article>
	</section>
	
	<div id="cusdis">
		
				<div id="cusdis_thread"
				style="background: none !important;"
				data-host="https://cusdis.com"
				data-app-id="aaae44f5-19b5-419e-88d9-9522e2617ece"
				data-page-id="https:&#x2F;&#x2F;doomy.org&#x2F;bevys-fourth-birthday&#x2F;"
				data-page-url="bevys-fourth-birthday"
				data-page-title="birthday_system.system()"
				data-theme="auto"
				></div>
				<script async defer src="/js/cusdis.es.js"></script>
		
	</div>
</div>


        <footer>
            
            <p>
                Feather theme by <a href="https://doomy.org">doomy</a>&nbsp;&nbsp;-&nbsp;&nbsp; Built with <a
                    href="https://getzola.org">Zola</a>
            </p>
            
        </footer>
    </div>
    
    <script>
        function change_theme(theme) {
            if (theme == "light") {
                document.body.classList.remove("dark");
                document.body.classList.add("light");
                document.querySelector('#syntax').href = '/syntax-theme-light.css';
            } else if (theme == "dark") {
                document.body.classList.add("dark");
                document.body.classList.remove("light");
                document.querySelector('#syntax').href = '/syntax-theme-dark.css';
            }
            localStorage.setItem("theme", theme);
        }

        window.addEventListener('load', () => {
            // Select the button
            const theme = (function () {
                const stored = localStorage.getItem("theme");
                if (stored == "null") {
                    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
                        return "dark";
                    } else {
                        return "light";
                    }
                } else {
                    return stored;
                }
            })();

            change_theme(theme);

            // Listen for a click on the button
            document.querySelector(".theme-switcher").addEventListener("click", function () {
                if (!document.body.classList.contains("dark")) {
                    change_theme("dark");
                } else {
                    change_theme("light");
                }
            });

        });
    </script>
    
    <script src="/js/footnote.js"></script>
</body>

</html>
